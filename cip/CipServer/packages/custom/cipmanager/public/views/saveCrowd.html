<section data-ng-controller="CipmanagerController" data-ng-init="initSaveCrowd()">
    <form name="crowdForm" class="form-horizontal" role="form" data-ng-submit="update(crowdForm.$valid)" novalidate>
        <fieldset>
            <legend>基本信息</legend>
            <div class="form-group" ng-class="{ 'has-error' : submitted && crowdForm.crowd_name.$invalid }">
                <label mean-token="'create-crowd_name'" class="col-md-2 control-label">人群名称</label>
                <div class="col-md-4">
                    <input name="crowd_name" type="text" class="form-control" data-ng-model="crowdDetail.crowdName"
                           id="crowd_name" placeholder="Crowd Name" required>
                    <div ng-show="submitted && crowdForm.crowd_name.$invalid" class="help-block">
                        <p ng-show="crowdForm.crowd_name.$error.required">Crowd name is required</p>
                    </div>
                </div>
            </div>
            <div class="form-group" ng-class="{ 'has-error' : submitted && crowdForm.description.$invalid }">
                <label mean-token="'create-description'" class="col-md-2 control-label">描述</label>
                <div class="col-md-4">
                    <input name="description" type="text" class="form-control" data-ng-model="crowdDetail.description"
                           id="description" placeholder="Description" required>
                    <div ng-show="submitted && crowdForm.description.$invalid" class="help-block">
                        <p ng-show="crowdForm.description.$error.required">Description is required</p>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label mean-token="'create-type'" class="col-md-2 control-label">人群类型</label>
                <div class="col-md-4">
                    <select class="form-control" ng-model="crowdDetail.type"
                            ng-options="x as x for x in crowd_type"></select>
                </div>
            </div>
        </fieldset>

        <fieldset>
            <!-- Show -->
            <legend>条件列表</legend>

            <table class="table table-hover">
                <h5>标签筛选条件</h5>
                <thead>
                <tr>
                    <th>序号</th>
                    <th>标签分类体系</th>
                    <th>标签</th>
                    <th>逻辑</th>
                    <th>覆盖人数</th>
                </tr>
                </thead>
                <tbody>
                <tr data-ng-repeat="condition in crowdDetail.selector.ontology">
                    <td>{{$index+1}}</td>
                    <td>{{condition.type}}</td>
                    <td>{{condition.factor}}</td>
                    <td ng-if="condition.operator!='dislike' && condition.operator!='like'">
                        权重{{condition.operator}}{{condition.weight}}
                    </td>
                    <td ng-if="condition.operator=='dislike' || condition.operator=='like'">{{condition.operator}}</td>
                    <td>{{condition.count}}</td>
                </tr>
                </tbody>
            </table>

            <table class="table table-hover">
                <h5>行为筛选条件</h5>
                <thead>
                <tr>
                    <th>序号</th>
                    <th>动作</th>
                    <th>对象</th>
                    <th>对象所属类目/属性体系</th>
                    <th>发生次数</th>
                    <th>发生时间</th>
                    <th>覆盖人数</th>
                </tr>
                </thead>
                <tbody>
                <tr data-ng-repeat="condition in crowdDetail.selector.behavior">
                    <td>{{$index+1}}</td>
                    <td>{{condition.action}}</td>
                    <td>{{condition.objectCategory}}</td>
                    <td ng-if="condition.objectType=='Category'">位于{{condition.ontologyType}}/{{condition.objectId}}目录下</td>
                    <td ng-if="condition.objectType=='Contains'">包含字段{{condition.objectType}} {{condition.objectId}}</td>
                    <td ng-if="condition.objectType=='Item'">物品ID={{condition.objectId}}</td>
                    <td>{{condition.operator}} {{condition.value}}次</td>
                    <td ng-if="condition.timeType=='absolute'">{{condition.startTime | date:'shortDate'}}--{{condition.endTime | date:'shortDate'}}</td>
                    <td ng-if="condition.timeType=='relative'">过去{{condition.startTime}}天内</td>
                    <td>{{condition.count}}</td>
                </tr>
                </tbody>
            </table>

            <div class="col-md-offset-8 col-md-3"><h4>满足上面所有条件 共覆盖{{crowdDetail.count}}人</h4></div>
        </fieldset>

        <div class="form-group">
            <div class="col-md-offset-4 col-md-3">
                <button mean-token="'create-save'" type="submit" ng-disabled="crowdForm.$invalid" class="btn btn-success btn-block">保存人群</button>
            </div>
        </div>

    </form>
</section>
