# This example build a complex undirected graph topology schema based on an android apps portal website
# running this script file in the command line shell. That is, GraphSQL> @./example/OLAP.txt

#drop graph and all edges
drop graph OLAP

drop edge AllDate_YYYY,YYYY_Quarter,Quarter_Month,Month_AppLog,AllChannel_Ch1, Ch1_Ch2,Ch2_ChannelLog,YYYY_ChannelLog,AllApps_OS,OS_URL,URL_AppLog,AllIPs_IPLevel2,IPLevel2_IPLevel3,IPLevel3_AppLog,IPLevel3_ChannelLog
drop vertex AppLog, ChannelLog, AllDate, YYYY, Quarter, Month, AllChannel, Ch1, Ch2, AllApps, OS, URL, AllIPs, IPLevel2, IPLevel3 

# create vertices and edges
create vertex AppLog (primary_id appID string, name string, ip string, downloadDate uint32)
create vertex ChannelLog (primary_id cookieID string, ip string, channel string compress, firstDownloadDate uint32)
create vertex AllDate (primary_id seed string, yearStart uint32, yearEnd uint32)
create vertex YYYY (primary_id year string)
create vertex Quarter (primary_id yyyyq uint32, yyyy uint32, quarterth string compress)
create vertex Month (primary_id yyyymm uint32, yyyy uint32, mm string compress)
create undirected edge AllDate_YYYY (from AllDate, to YYYY)
create undirected edge YYYY_Quarter (from YYYY, to Quarter)
create undirected edge Quarter_Month (from Quarter, to Month)
create undirected edge Month_AppLog (from Month, to AppLog)

create vertex ALLChannel(primary_id seed string)
create vertex Ch1(primary_id cid string)
create vertex Ch2(primary_id ccid string)

create undirected edge AllChannel_Ch1 (from AllChannel, to Ch1)
create undirected edge Ch1_Ch2 (from Ch1, to Ch2)
create undirected edge Ch2_ChannelLog (from Ch2, to ChannelLog)
create undirected edge YYYY_ChannelLog (from YYYY, to ChannelLog)

create vertex AllApps(primary_id seed string)
create vertex OS(primary_id name string)
create vertex URL(primary_id link string)


create undirected edge AllApps_OS (from AllApps, to OS)
create undirected edge OS_URL (from OS, to URL)
create undirected edge  URL_AppLog (from URL, to AppLog)


create vertex AllIPs(primary_id seed string)
create vertex IPLevel2(primary_id region string)
create vertex IPLevel3(primary_id address string)

create undirected edge AllIPs_IPLevel2 (from AllIPs, to IPLevel2)
create undirected edge IPLevel2_IPLevel3 (from IPLevel2, to IPLevel3)
create undirected edge  IPLevel3_AppLog (from IPLevel3, to AppLog)
create undirected edge  IPLevel3_ChannelLog (from IPLevel3, to ChannelLog)



# create graph
create graph OLAP (AppLog, AllDate, YYYY, Quarter, Month, AllIPs, IPLevel2, IPLevel3, AllIPs_IPLevel2, IPLevel2_IPLevel3, IPLevel3_AppLog, IPLevel3_ChannelLog, AllDate_YYYY , YYYY_ChannelLog, YYYY_Quarter, Quarter_Month,Month_AppLog,AllChannel, Ch1, Ch2, AllChannel_Ch1, ChannelLog, Ch1_Ch2, Ch2_ChannelLog, AllApps, OS, URL, AllApps_OS, OS_URL, URL_AppLog)


# create yaml and pdf visualization
export schema olap

