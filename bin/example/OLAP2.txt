# This example build a complex undirected graph topology schema based on an android apps portal website
# running this script file in the command line shell. That is, GraphSQL> @./example/OLAP.txt

#drop graph and all edges
drop graph OLAP

drop edge AllDate_YYYY,YYYY_Quarter,Quarter_Month,Month_AppLog,AllChannel_Ch1, Ch1_Ch2,Ch2_ChannelLog,YYYY_ChannelLog,AllApps_OS,OS_URL,URL_AppLog,AllIPs_IPLevel2,IPLevel2_IPLevel3,IPLevel3_AppLog,IPLevel3_ChannelLog
drop vertex AppLog, ChannelLog, AllDate, YYYY, Quarter, Month, AllChannel, Ch1, Ch2, AllApps, OS, URL, AllIPs, IPLevel2, IPLevel3 


# create vertices and edges
create vertex AppLog (primary_id appID string, name string, ip string, downloadDate uint32)
create vertex ChannelLog (primary_id cookieID string, ip string, channel string compress, firstDownloadDate uint32)
create vertex AllDate (primary_id seed string, yearStart uint32, yearEnd uint32)
create vertex YYYY (primary_id year string)
create vertex Quarter (primary_id yyyyq uint32, yyyy uint32, quarterth string compress)
create vertex Month (primary_id yyyymm uint32, yyyy uint32, mm string compress)
create directed (AllDate -> YYYY) edge AllDate_YYYY 
create directed (YYYY -> Quarter) edge YYYY_Quarter
create directed (Quarter -> Month) edge Quarter_Month 
create directed (Month -> AppLog) edge Month_AppLog

create vertex ALLChannel(primary_id seed string)
create vertex Ch1(primary_id cid string)
create vertex Ch2(primary_id ccid string)

create directed (AllChannel -> Ch1) edge AllChannel_Ch1
create directed (Ch1 -> Ch2) edge Ch1_Ch2 
create directed (Ch2 -> ChannelLog) edge Ch2_ChannelLog 


create directed (YYYY -> ChannelLog) edge YYYY_ChannelLog 


create vertex AllApps(primary_id seed string)
create vertex OS(primary_id name string)
create vertex URL(primary_id link string)


create directed (AllApps -> OS) edge AllApps_OS
create directed (OS -> URL) edge OS_URL 
create directed (URL -> AppLog ) edge  URL_AppLog


create vertex AllIPs(primary_id seed string)
create vertex IPLevel2(primary_id region string)
create vertex IPLevel3(primary_id address string)

create directed (AllIPs -> IPLevel2) edge AllIPs_IPLevel2
create directed (IPLevel2 -> IPLevel3) edge IPLevel2_IPLevel3 
create directed (IPLevel3 -> AppLog ) edge  IPLevel3_AppLog
create directed (IPLevel3 -> ChannelLog ) edge  IPLevel3_ChannelLog




# create graph
create graph OLAP (AppLog, AllDate, YYYY, Quarter, Month, AllIPs, IPLevel2, IPLevel3, AllIPs_IPLevel2, IPLevel2_IPLevel3, IPLevel3_AppLog, IPLevel3_ChannelLog, AllDate_YYYY ,YYYY_Quarter, Quarter_Month, YYYY_ChannelLog,Month_AppLog,AllChannel, Ch1, Ch2, AllChannel_Ch1, ChannelLog, Ch1_Ch2, Ch2_ChannelLog, AllApps, OS, URL, AllApps_OS, OS_URL, URL_AppLog)

# create yaml and pdf visualization
export schema olap
